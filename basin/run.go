package basin

import (
	"fmt"
	"log"
)

// Run a single simulation with water balance checking
func Run(ldr *Loader, rill, m, n float64) float64 {
	d := newDomain(ldr)
	b := d.newSubDomain(ldr.outlet)
	fmt.Printf("\n building sample HRUs and TOPMODEL\n\n")
	// smpl := b.toDefaultSample(rill, m, n)
	// smpl := b.toSampleU(0.189217, 0.355521, 0.383248, 0.399292, 0.285484, 0.457991, 0.538984, 0.062703, 0.909771, 0.493195, 0.639474, 0.611202, 0.323529, 0.688711, 0.133744, 0.994318, 0.278437, 0.432782, 0.876103, 0.070119, 0.280673, 0.363366, 0.385633, 0.743716, 0.607882, 0.844216, 0.634842, 0.954127, 0.608979, 0.465710, 0.234295, 0.765479, 0.520441, 0.649710, 0.764205, 0.375234)
	smpl := b.toSampleU(0.12958594128189166, 0.33751034406732233, 0.3517190362646418, 0.16374107363310889, 0.8127152405643698, 0.8459842769287653, 0.9421089294630323, 0.04939533652277711, 0.01849119842187086, 0.035522353840134045, 0.06931435664042102, 0.13422501742399848, 0.9796603726983009, 0.6322179850211794, 0.5992294277444489, 0.9339759770939073, 0.18357131816809572, 0.40553384240303203, 0.8567417701260007, 0.6617576210966368, 0.1637022989277712, 0.24342428879600753, 0.5637663727159402, 0.7099829417700398, 0.9468875557788897, 0.9124745543664514, 0.3976609552541257, 0.10970369270419887, 0.5340533771409053, 0.9738664421323615, 0.1928905939959194, 0.06807073997310062, 0.8299095619277346, 0.7409330744630067, 0.7392119964037015, 0.24653138711267425)
	// smpl1 := b.toSampleU(0.12958594128189166, 0.33751034406732233, 0.3517190362646418, 0.16374107363310889, 0.8127152405643698, 0.8459842769287653, 0.9421089294630323, 0.04939533652277711, 0.01849119842187086, 0.035522353840134045, 0.06931435664042102, 0.13422501742399848, 0.9796603726983009, 0.6322179850211794, 0.5992294277444489, 0.9339759770939073, 0.18357131816809572, 0.40553384240303203, 0.8567417701260007, 0.6617576210966368, 0.1637022989277712, 0.24342428879600753, 0.5637663727159402, 0.7099829417700398, 0.9468875557788897, 0.9124745543664514, 0.3976609552541257, 0.10970369270419887, 0.5340533771409053, 0.9738664421323615, 0.1928905939959194, 0.06807073997310062, 0.8299095619277346, 0.7409330744630067, 0.7392119964037015, 0.24653138711267425)

	// if smpl.rill != smpl1.rill {
	// 	println("rill")
	// }
	// if ok, s := smpl.gw.IsSame(&smpl1.gw); !ok {
	// 	println("gw: " + s)
	// }

	for _, c := range b.cids {
		if smpl.ws[c] == nil {
			log.Fatalln(" basin.Run() error: nil hru")
		}
	}
	return b.evalCascKineWB(&smpl, true)
}
